---
layout: post
title: è¯†åˆ«å­—ç¬¦ä¸²ä¸­çš„ Emoji è¡¨æƒ…
date: 2019-01-01 20:36:24
---

### Unicode å­—ç¬¦é›†

Unicode æ ‡å‡†ä¸ºä¸–ç•Œä¸Šå‡ ä¹Žæ‰€æœ‰çš„[^1]ä¹¦å†™ç³»ç»Ÿé‡Œæ‰€ä½¿ç”¨çš„æ¯ä¸€ä¸ªå­—ç¬¦æˆ–ç¬¦å·å®šä¹‰äº†ä¸€ä¸ªå”¯ä¸€çš„æ•°å­—ã€‚è¿™ä¸ªæ•°å­—å«åšç ç‚¹ï¼ˆcode pointsï¼‰ï¼Œä»¥ U+xxxx è¿™æ ·çš„æ ¼å¼å†™æˆï¼Œæ ¼å¼é‡Œçš„ xxxx ä»£è¡¨å››åˆ°å…­ä¸ªåå…­è¿›åˆ¶çš„æ•°ã€‚

æœ€åˆï¼ŒUnicode ç¼–ç æ˜¯è¢«è®¾è®¡ä¸º 16 ä½çš„ï¼Œæä¾›äº† 65,536 ä¸ªå­—ç¬¦çš„ç©ºé—´ã€‚åŽæ¥ï¼Œè€ƒè™‘åˆ°è¦ç¼–ç åŽ†å²ä¸Šçš„æ–‡å­—ä»¥åŠä¸€äº›å¾ˆå°‘ä½¿ç”¨çš„æ—¥æœ¬æ±‰å­—å’Œä¸­å›½æ±‰å­—ï¼ŒUnicode ç¼–ç æ‰©å±•åˆ°äº† 21 ä½ï¼ˆä»Ž U+0000 åˆ° U+10FFFFï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬çŽ°åœ¨æŽ¥è§¦åˆ°çš„ Unicode æ˜¯ 21 ä½çš„ç¼–ç ã€‚

ç¼–ç ç©ºé—´è¢«åˆ†æˆ 17 ä¸ªå¹³é¢ï¼ˆplaneï¼‰ï¼Œæ¯ä¸ªå¹³é¢æœ‰ 65,536 ä¸ªå­—ç¬¦ã€‚

![](../../../images/UnicodePlanes.jpg)

0 å·å¹³é¢å«åšã€ŒåŸºæœ¬å¤šæ–‡ç§å¹³é¢ã€ï¼ˆBasic Multilingual Plane, BMPï¼‰ï¼Œæ¶µç›–äº†å‡ ä¹Žæ‰€æœ‰ä½ èƒ½é‡åˆ°çš„å­—ç¬¦ã€‚å…¶å®ƒå¹³é¢å«åšè¡¥å……å¹³é¢ï¼Œå¤§å¤šæ˜¯ç©ºçš„ã€‚

### UTF ç¼–ç 

Unicode å®šä¹‰äº†å­—ç¬¦åˆ°ç ç‚¹çš„æ˜ å°„ï¼Œå…·ä½“å¦‚ä½•åœ¨è®¡ç®—æœºä¸Šå­˜å‚¨ï¼Œå°±éœ€è¦ä½¿ç”¨ UTF ï¼ˆUnicode Transformation Formatsï¼Œç®€ç§° UTFï¼‰ç¼–ç äº†ã€‚æœ‰ä¸‰ç§ç¼–ç ç¼–ç æ ¼å¼ï¼ŒUIF-32ã€UTF-16 å’Œ UTF-8ï¼Œçœ‹åå­—å°±çŸ¥é“å®ƒä»¬å«ä¹‰ï¼Œ32ã€16ã€8 è¡¨ç¤ºç”¨äºŽå­˜å‚¨é•¿åº¦ã€‚ä½¿ç”¨ 32 ä½å­˜å‚¨ä¸€ä¸ªç ç‚¹ï¼ˆç ç‚¹é•¿åº¦ 21 ä½ï¼‰å¤ªæµªè´¹ç©ºé—´äº†ï¼ŒçŽ°å®žä¸­å¾ˆå°‘ä½¿ç”¨ã€‚UTF-16 ä½¿ç”¨ 16 ä½å›ºå®šé•¿åº¦çš„ç å…ƒï¼ŒBMP çš„èŒƒå›´åœ¨ 0000-FFFF ä¹‹é—´ï¼Œä¸€ä¸ªç ç‚¹ç›´æŽ¥ä¸Žä¸€ä¸ªç å…ƒç›¸æ˜ å°„ï¼Œä½¿ç”¨ UTF-16 æ¯” UTF-32 èŠ‚çœä¸€åŠçš„ç©ºé—´ã€‚å…¶å®ƒå¹³é¢çš„å­—ç¬¦è¶…è¿‡äº† 16 ä½çš„è¡¨ç¤ºèŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ª UTF-16 ç å…ƒç»„åˆèµ·æ¥è¡¨ç¤ºï¼Œå«åšä»£ç†å¯¹ï¼ˆsurrogate pairï¼‰ã€‚

###NSSTring å­˜å‚¨

NSString å¯¹è±¡ä»£è¡¨çš„å…¶å®žæ˜¯ç”¨ UTF-16 ç¼–ç çš„ç å…ƒç»„æˆçš„æ•°ç»„ã€‚ç›¸åº”åœ°ï¼Œlength æ–¹æ³•çš„è¿”å›žå€¼ä¹Ÿæ˜¯å­—ç¬¦ä¸²åŒ…å«çš„ç å…ƒä¸ªæ•°ï¼ˆè€Œä¸æ˜¯å­—ç¬¦ä¸ªæ•°ï¼‰ã€‚è¯•ç€æ‰“å° ðŸ˜›(U+1F61B) çš„é•¿åº¦ï¼Œè¾“å‡º 2ã€‚å› ä¸º U+1F61B è¶…å‡ºäº† BMP çš„èŒƒå›´ï¼Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ª UTF-16 ç å…ƒç»„åˆæˆä»£ç†å¯¹è¡¨ç¤ºã€‚

```objc
 NSString *emoji = @"ðŸ˜›";
 NSLog(@"emoji.length: %@", @(emoji.length)); // emoji.length: 2
```

åœ¨å·¥ä½œä¸­ç»å¸¸ä¼šé‡åˆ°é™åˆ¶ç”¨æˆ·è¾“å…¥å­—ç¬¦ä¸ªæ•°çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¦æ±‚ç”¨æˆ·åæœ€é•¿ä¸è¶…è¿‡ 10 ä¸ªå­—ç¬¦ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ length åˆ¤æ–­å°±å¯ä»¥äº†ï¼Œå¦‚æžœç”¨æˆ·è¾“å…¥äº† emoji è¡¨æƒ…ï¼Œä½¿ç”¨ length åˆ¤æ–­å¯èƒ½å°±ä¸ç¬¦åˆè¦æ±‚äº†ã€‚ç”¨æˆ·è¾“å…¥äº† 3 ä¸ª ðŸ‘¨ðŸ»â€âš•ï¸ï¼ˆ1F468 1F3FB 200D 2695 FE0Fï¼‰ï¼Œæ‰“å°å‡ºlength çš„é•¿åº¦æ˜¯ 21ï¼ˆæ¯ä¸ª ðŸ‘¨ðŸ»â€âš•ï¸ é•¿åº¦ä¸º: 2 + 2 + 1 + 1 + 1ï¼‰ï¼Œå·²ç»è¶…è¿‡ 10 ï¼Œæç¤ºç”¨è¶…é•¿äº†è‚¯å®šä¸åˆç†ã€‚å¦‚ä½•åˆ¤æ–­å­—ç¬¦é•¿åº¦å‘¢ï¼Ÿ`enumerateSubstringsInRange:options:usingBlock:` æ–¹æ³•ä»¥å­—ç¬¦ä¸ºå•ä½è¿›è¡ŒéåŽ†ï¼Œä½¿ç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥ç»Ÿè®¡å­—ç¬¦çœŸæ­£çš„é•¿åº¦ã€‚

```objc
__block NSUInteger realLength = 0;
[emoji enumerateSubstringsInRange:NSMakeRange(0, emoji.length) options:NSStringEnumerationByComposedCharacterSequences usingBlock:^(NSString * _Nullable substring, NSRange substringRange, NSRange enclosingRange, BOOL * _Nonnull stop) {
    NSLog(@"==> subRange:%@, subStr:%@", NSStringFromRange(substringRange), substring);
    realLength += 1;
}];
NSLog(@"realLength: %@", @(realLength)); // realLength: 3
```
###emoji

// 


